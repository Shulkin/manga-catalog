angular.module("manga.config",[]).value("MOCK",!1).value("MOCK_SERIES_COUNT",42).value("MOCK_AUTHORS_COUNT",28),angular.module("manga.routes",[]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/home/news"),a.state("home",{url:"/home",templateUrl:"./views/home.html"}).state("home.news",{url:"/news",templateUrl:"./views/news.html",controller:"NewsCtrl as news"}).state("home.series",{url:"/series",templateUrl:"./views/series.html",controller:"SeriesCtrl as series"}).state("home.series-info",{url:"/series/:id",templateUrl:"./views/series-info.html",controller:"SeriesInfoCtrl as manga"}).state("home.series-create",{url:"/add/manga",templateUrl:"./views/series-create.html",controller:"SeriesAddCtrl as manga"}).state("home.authors",{url:"/authors",templateUrl:"./views/authors.html",controller:"AuthorsCtrl as authors"}).state("home.authors-info",{url:"/authors/:id",templateUrl:"./views/authors-info.html",controller:"AuthorsInfoCtrl as author"}).state("home.authors-create",{url:"/add/author",templateUrl:"./views/authors-create.html",controller:"AuthorsAddCtrl as author"}).state("login",{url:"/login",templateUrl:"./views/login.html",controller:"AuthCtrl"}).state("register",{url:"/register",templateUrl:"./views/register.html",controller:"AuthCtrl"})}]);var mangaApp=angular.module("manga.app",["ngAnimate","ui.bootstrap","ui.router","manga.routes","manga.config","manga.utilities","manga.auth","manga.auth.ctrl","news.ctrl","news.service","news.mock","authors.ctrl","authors.info.ctrl","authors.add.ctrl","authors.service","authors.mock","authors.info.service","series.ctrl","series.info.ctrl","series.add.ctrl","series.service","series.mock","series.info.service","genres.service"]);angular.module("manga.auth.ctrl",[]).controller("AuthCtrl",["Auth","$scope","$state",function(a,b,c){b.user={},b.register=function(){a.register(b.user).error(function(a){b.error=a}).then(function(){c.go("home.news")})},b.logIn=function(){a.logIn(b.user).error(function(a){b.error=a}).then(function(){c.go("home.news")})}}]),angular.module("authors.add.ctrl",[]).controller("AuthorsAddCtrl",["Authors","$state",function(a,b){function c(){d.name="",d.gender="Male",d.date=new Date}var d=this;d.format="dd-MMMM-yyyy",d.status={opened:!1},c(),d.open=function(a){d.status.opened=!0},d.save=function(){var c={name:d.name,gender:d.gender,birthDate:d.date,series:[]};a.create(c).then(function(a){b.go("home.authors")},function(a){console.log("Error "+a)})}}]),angular.module("authors.ctrl",["angularUtils.directives.dirPagination"]).value("AUTHORS_PER_PAGE",10).value("AUTHORS_COLUMNS",[{header:"Name",fieldName:"name",sortable:!0},{header:"Series",fieldName:"series",sortable:!0},{header:"Most Numerous Genre",fieldName:"mostNumerousGenre",sortable:!1}]).controller("AuthorsCtrl",["AUTHORS_COLUMNS","AUTHORS_PER_PAGE","Auth","Authors",function(a,b,c,d){function e(){f.list=[],d.getAll().then(function(a){f.list=a;for(var b=0;b<f.list.length;b++)f.list[b].mostNumerousGenre=d.getMostNumerousGenre(f.list[b],5)},function(a){console.log("Error "+a)})}var f=this;f.columns=a,f.perPage=b,f.sortType=f.columns[0].fieldName,f.sortReverse=!1,f.searchQuery="",e(),f.isUserLoggedIn=c.isLoggedIn,f.delete=function(a){console.log("[AuthorsCtrl.delete()] authorId = "+a)},f.sort=function(a){f.sortType!==a?f.sortReverse=!1:f.sortReverse=!f.sortReverse,f.sortType=a},f.isAscending=function(a){return f.sortType===a&&f.sortReverse},f.isDescending=function(a){return f.sortType===a&&!f.sortReverse}}]),angular.module("authors.info.ctrl",["manga.datepicker.ctrl"]).controller("AuthorsInfoCtrl",["SERIES_COLUMNS","Auth","Genres","Authors","AuthorsInfo","$stateParams",function(a,b,c,d,e,f){function g(){k.editing={}}function h(){d.get(l).then(function(b){k.name=b.name,k.gender=b.gender,k.birthDate=b.birthDate,k.series=b.series,e.setBirthDate(k.birthDate),e.shareBirthDate(),k.allGenres=d.getAllGenres(b),k.seriesColumns=a},function(a){console.log("Error "+a)})}function i(){k.birthDate=e.getBirthDate();var a={name:k.name,gender:k.gender,birthDate:k.birthDate};d.update(l,a).then(function(){h()},function(a){console.log("Error "+a)})}function j(){h(),g()}var k=this,l=f.id;j(),k.isUserLoggedIn=b.isLoggedIn,k.genreToString=function(a){return c.toString(a)},k.edit=function(a){k.editing[a]=!0},k.isEdit=function(a){return a in k.editing&&k.editing[a]},k.save=function(a){i(),g()}}]),angular.module("manga.datepicker.ctrl",[]).controller("DatePickerCtrl",["AuthorsInfo","$scope",function(a,b){b.formats=["dd-MMMM-yyyy"],b.format=b.formats[0],b.status={opened:!1},b.init=function(){b.date=a.getBirthDate()},b.init(),b.$on("SharedBirthDate",function(){b.date=a.getBirthDate()}),b.changeDate=function(){a.setBirthDate(b.date)},b.clear=function(){b.date=null},b.open=function(a){b.status.opened=!0}}]).controller("YearPickerCtrl",["SeriesInfo","$scope",function(a,b){b.formats=["yyyy"],b.format=b.formats[0],b.dateOptions={formatYear:"yyyy",startingDay:1,minMode:"year"},b.status={opened:!1},b.init=function(){b.date=new Date,b.year=a.getYear(),b.date.setFullYear(b.year)},b.init(),b.$on("SharedYear",function(){b.year=a.getYear();var c=new Date;c.setFullYear(b.year),b.date=c}),b.changeDate=function(){b.year=b.date.getFullYear(),a.setYear(b.year)},b.clear=function(){b.date=null},b.open=function(a){b.status.opened=!0}}]),angular.module("news.ctrl",[]).controller("NewsCtrl",["News",function(a){function b(){c.list=[],a.getAll().then(function(a){c.list=a},function(a){console.log("Error "+a)})}var c=this;b()}]),angular.module("series.add.ctrl",[]).controller("SeriesAddCtrl",["Genres","Authors","Series","$state",function(a,b,c,d){function e(b){a.getAll().then(function(a){b(a)},function(a){console.log("Error "+a)})}function f(a){b.getAll().then(function(b){a(b)},function(a){console.log("Error "+a)})}function g(){h.title="",h.description="",h.date=new Date,h.genre=[],h.allGenres=[],e(function(a){h.allGenres=a,h.allGenres.length>0&&(h.newGenre=h.allGenres[0]._id)}),h.allAuthors=[],f(function(a){h.allAuthors=a,h.allAuthors.length>0&&(h.authorId=h.allAuthors[0]._id)})}var h=this;h.format="yyyy",h.options={formatYear:"yyyy",startingDay:1,minMode:"year"},h.status={opened:!1},g(),h.open=function(a){h.status.opened=!0},h.addGenre=function(a){for(var b={_id:a},c=0;c<h.allGenres.length;c++)if(h.allGenres[c]._id===a){b={_id:h.allGenres[c]._id,name:h.allGenres[c].name};break}h.genre.push(b)},h.removeGenre=function(a){for(var b=h.genre.length;b--;)h.genre[b]._id===a&&h.genre.splice(b,1)},h.save=function(){var e={title:h.title,description:h.description,year:h.date.getFullYear(),genre:a.extractIds(h.genre),author:h.authorId};c.create(e).then(function(a){b.addManga(h.authorId,a._id).then(function(a){d.go("home.series")},function(a){console.log("Error "+a)})},function(a){console.log("Error "+a)})}}]),angular.module("series.ctrl",["angularUtils.directives.dirPagination"]).value("SERIES_PER_PAGE",10).value("SERIES_COLUMNS",[{header:"Title",fieldName:"title",sortable:!0},{header:"Genre",fieldName:"genre",sortable:!1},{header:"Year",fieldName:"year",sortable:!0}]).controller("SeriesCtrl",["SERIES_COLUMNS","SERIES_PER_PAGE","Auth","Genres","Series",function(a,b,c,d,e){function f(){g.list=[],e.getAll().then(function(a){g.list=a},function(a){console.log("Error "+a)})}var g=this;g.columns=a,g.perPage=b,g.sortType=g.columns[0].fieldName,g.sortReverse=!1,g.searchQuery="",f(),g.isUserLoggedIn=c.isLoggedIn,g.delete=function(a){console.log("[SeriesCtrl.delete()] mangaId = "+a)},g.genreToString=function(a){return d.toString(a)},g.sort=function(a){g.sortType!==a?g.sortReverse=!1:g.sortReverse=!g.sortReverse,g.sortType=a},g.isAscending=function(a){return g.sortType===a&&g.sortReverse},g.isDescending=function(a){return g.sortType===a&&!g.sortReverse}}]),angular.module("series.info.ctrl",["manga.datepicker.ctrl"]).controller("SeriesInfoCtrl",["Auth","Genres","Series","Authors","SeriesInfo","$stateParams",function(a,b,c,d,e,f){function g(){n.editing={}}function h(){n.allAuthors=[],d.getAll().then(function(a){n.allAuthors=a},function(a){console.log("Error "+a)})}function i(){n.allGenres=[],b.getAll().then(function(a){n.allGenres=a,n.newGenre=a[0]._id},function(a){console.log("Error "+a)})}function j(a,b){d.deleteManga(a,o).then(function(a){},function(a){console.log("Error "+a)}),d.addManga(b,o).then(function(a){},function(a){console.log("Error "+a)})}function k(){c.get(o).then(function(a){n.title=a.title,n.description=a.description,n.genre=a.genre,n.author=a.author,n.year=a.year,e.setYear(n.year),e.shareYear(),n.authorId=n.author._id,n.genreString=b.toString(a.genre)},function(a){console.log("Error "+a)})}function l(){n.year=e.getYear(),n.author._id!==n.authorId&&j(n.author._id,n.authorId);var a={title:n.title,description:n.description,genre:b.extractIds(n.genre),author:n.authorId,year:n.year};c.update(o,a).then(function(){k()},function(a){console.log("Error "+a)})}function m(){k(),i(),h(),g()}var n=this,o=f.id;m(),n.isUserLoggedIn=a.isLoggedIn,n.addGenre=function(a){for(var b={_id:a},c=0;c<n.allGenres.length;c++)if(n.allGenres[c]._id===a){b={_id:n.allGenres[c]._id,name:n.allGenres[c].name};break}n.genre.push(b)},n.removeGenre=function(a){for(var b=n.genre.length;b--;)n.genre[b]._id===a&&n.genre.splice(b,1)},n.edit=function(a){n.editing[a]=!0},n.isEdit=function(a){return a in n.editing&&n.editing[a]},n.save=function(a){l(),g()}}]),angular.module("manga.auth",[]).factory("Auth",["$http","$window",function(a,b){var c={};return c.saveToken=function(a){b.localStorage["manga-catalog-token"]=a},c.getToken=function(){return b.localStorage["manga-catalog-token"]},c.isLoggedIn=function(){var a=c.getToken();if(a){var d=JSON.parse(b.atob(a.split(".")[1]));return d.exp>Date.now()/1e3}return!1},c.currentUser=function(){if(c.isLoggedIn()){var a=c.getToken(),d=JSON.parse(b.atob(a.split(".")[1]));return d.username}},c.register=function(b){return a.post("/auth/register",b).success(function(a){c.saveToken(a.token)})},c.logIn=function(b){return a.post("/auth/login",b).success(function(a){c.saveToken(a.token)})},c.logOut=function(a){b.localStorage.removeItem("manga-catalog-token")},c}]).controller("NavCtrl",["Auth","$scope",function(a,b){b.isLoggedIn=a.isLoggedIn,b.currentUser=a.currentUser,b.logOut=a.logOut}]),angular.module("authors.info.service",[]).factory("AuthorsInfo",["$rootScope",function(a){return{data:{birthDate:new Date},getBirthDate:function(){return this.data.birthDate},setBirthDate:function(a){this.data.birthDate=a},shareBirthDate:function(){a.$broadcast("SharedBirthDate")}}}]),angular.module("authors.mock",[]).value("AUTHOR_NAMES",["Oda Eiichiro","Kishimoto Masashi","Araki Hirohiko","Akira Toriyama"]).value("AUTHOR_GENDERS",["Male","Female"]).factory("AuthorsMock",["MOCK_SERIES_COUNT","AUTHOR_NAMES","AUTHOR_GENDERS","Utils","SeriesMock",function(a,b,c,d,e){function f(f){for(var g=[],h=d.randomInt(0,a),i=0;i<h;i++)g.push(e.createManga(i));var j={_id:"author_"+f,name:b[d.randomInt(0,b.length-1)],gender:c[d.randomInt(0,c.length-1)],birthDate:new Date,series:g};return j}return{createList:function(a){for(var b=[],c=0;c<a;c++){var d=f(c);b.push(d)}return b},createAuthor:function(a){return f(a)}}}]),angular.module("authors.service",[]).factory("Authors",["MOCK","MOCK_AUTHORS_COUNT","AuthorsMock","Auth","$http",function(a,b,c,d,e){function f(a){for(var b={},c=a.series,d=0;d<c.length;d++)for(var e=c[d].genre,f=0;f<e.length;f++){var g=e[f].name;g in b||(b[g]=0),b[g]++}return b}return{getAll:function(){return a?new Promise(function(a,d){a(c.createList(b))}):e.get("/api/authors").then(function(a){return a.data})},create:function(a){return e.post("api/authors",a,{headers:{Authorization:"Bearer "+d.getToken()}}).then(function(a){return a.data})},get:function(b){return a?new Promise(function(a,d){a(c.createAuthor(b))}):e.get("/api/authors/"+b).then(function(a){return a.data})},update:function(a,b){return e.put("/api/authors/"+a,b,{headers:{Authorization:"Bearer "+d.getToken()}}).then(function(a){return a.data})},addManga:function(a,b){var c={id:b};return e.put("/api/authors/"+a+"/manga",c,{headers:{Authorization:"Bearer "+d.getToken()}}).then(function(a){return a.data})},deleteManga:function(a,b){return e.delete("/api/authors/"+a+"/manga/"+b,{headers:{Authorization:"Bearer "+d.getToken()}}).then(function(a){return a.data})},getMostNumerousGenre:function(a,b){var c=f(a),d=Object.keys(c).sort(function(a,b){return c[a]-c[b]}),e=d.slice(0,b);return e.join(", ")},getAllGenres:function(a){var b=f(a),c=[];for(var d in b)c.push(d+" ("+b[d]+")");return c.join(", ")}}}]),angular.module("genres.service",[]).factory("Genres",["$http",function(a){return{getAll:function(){return a.get("/api/genres").then(function(a){return a.data})},get:function(b){return a.get("/api/genres/"+b).then(function(a){return a.data})},toString:function(a){for(var b="",c=0;c<a.length;c++)b+=a[c].name,c<a.length-1&&(b+=", ");return b},extractIds:function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]._id);return b}}}]),angular.module("news.mock",[]).value("NEWS_TITLES",["This is first title","This is second title"]).value("USERS",["admin","user"]).factory("NewsMock",["NEWS_TITLES","USERS","Utils",function(a,b,c){return{createList:function(d){for(var e=[],f=0;f<d;f++){var g={title:a[c.randomInt(0,a.length-1)],body:"Lorem ipsum dolor sit amet, consectetur adipisicing elit",author:b[c.randomInt(0,b.length-1)],date:new Date};e.push(g)}return e}}}]),angular.module("news.service",[]).factory("News",["NewsMock","$http",function(a,b){return{getAll:function(){return new Promise(function(b,c){b(a.createList(3))})}}}]),angular.module("series.info.service",[]).factory("SeriesInfo",["$rootScope",function(a){return{data:{year:2007},getYear:function(){return this.data.year},setYear:function(a){this.data.year=a},shareYear:function(){a.$broadcast("SharedYear")}}}]),angular.module("series.mock",[]).value("MANGA_TITLES",["One Piece","Naruto","Bleach","Karakuri Circus","Shaman King","Berserk","Shamo","JoJo's Bizarre Adventure","Blame!","Homunculus","Air Gear","Shigurui","Toriko","Ushio and Tora"]).value("MANGA_GENRES",["Shounen","Action","Adventure","Horror","Drama","Comedy","Seinen"]).factory("SeriesMock",["MANGA_TITLES","MANGA_GENRES","AUTHOR_NAMES","Utils",function(a,b,c,d){function e(a){var b={_id:"author_"+a,name:c[d.randomInt(0,c.length-1)]};return b}function f(c){for(var f=[],g=d.randomInt(1,b.length),h=0;h<g;h++)f.push({_id:"genre_"+h,name:b[d.randomInt(0,b.length-1)]});var i=e("0"),j={_id:"manga_"+c,title:a[d.randomInt(0,a.length-1)],description:"Lorem ipsum dolor sit amet, consectetur adipisicing elit",year:d.randomInt(1950,2014),genre:f,author:i};return j}return{createList:function(a){for(var b=[],c=0;c<a;c++){var d=f(c);b.push(d)}return b},createManga:function(a){return f(a)}}}]),angular.module("series.service",[]).factory("Series",["MOCK","MOCK_SERIES_COUNT","SeriesMock","Auth","$http",function(a,b,c,d,e){return{getAll:function(){return a?new Promise(function(a,d){a(c.createList(b))}):e.get("/api/series").then(function(a){return a.data})},create:function(a){return e.post("api/series",a,{headers:{Authorization:"Bearer "+d.getToken()}}).then(function(a){return a.data})},get:function(b){return a?new Promise(function(a,d){a(c.createManga(b))}):e.get("/api/series/"+b).then(function(a){return a.data})},update:function(a,b){return e.put("/api/series/"+a,b,{headers:{Authorization:"Bearer "+d.getToken()}}).then(function(a){return a.data})}}}]),angular.module("manga.utilities",[]).factory("Utils",function(){return{randomInt:function(a,b){var c=a+Math.random()*(b+1-a);return c=Math.floor(c)}}});